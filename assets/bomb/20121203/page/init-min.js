KISSY.add("page/mods/bomb",function(a){function e(b){this.config=a.merge(d,b),this.status=-1,this.init()}var b=a.Node.all,c=a.DOM,d={size:9,mines:10,time:100};return a.augment(e,{init:function(a){a&&(this.config.size+=1,this.config.mines+=1),this.time=this.config.time,this.unopen=this.config.size*this.config.size,this.last=this.config.mines,this.mineArr=null,this.create(),this.bindEvent(),this.status>1&&this.start()},create:function(){var a=this.config.size,b=this.config.mines,c=0,d,e,f,g,h,i;this.mineArr=new Array(a);var j=this.mineArr;for(;c<a;c++)j[c]=new Array(a);for(d=0;d<a;d++)for(e=0;e<a;e++)j[d][e]=0;while(b>0)h=Math.floor(Math.random()*a),i=Math.floor(Math.random()*a),j[h][i]!==-1&&(j[h][i]=-1,b--);for(f=0;f<a;f++)for(g=0;g<a;g++)j[f][g]!==-1&&(f>0&&g>0&&j[f-1][g-1]==-1&&j[f][g]++,f>0&&j[f-1][g]==-1&&j[f][g]++,f>0&&g<a-1&&j[f-1][g+1]==-1&&j[f][g]++,g>0&&j[f][g-1]==-1&&j[f][g]++,g<a-1&&j[f][g+1]==-1&&j[f][g]++,f<a-1&&g>0&&j[f+1][g-1]==-1&&j[f][g]++,f<a-1&&j[f+1][g]==-1&&j[f][g]++,g<a-1&&f<a-1&&j[f+1][g+1]==-1&&j[f][g]++);this.createNav(),this.createTable(a)},createNav:function(){b("#content").empty(),this.config.numEl=this.config.floor=this.config.btn=this.config.flagEl=this.config.timeEl=null;var a=this,d=c.create('<div id="nav"></div>'),e=c.create('<p class="floor" title="\u5173\u6570"></p>'),f=c.create('<p class="num" title="\u96f7\u7684\u6570\u91cf"></p>'),g=c.create('<button class="ks-button">\u5f00\u59cb</button>'),h=c.create('<p class="time" title="\u65f6\u95f4"></p>'),i=c.create('<p class="isFlag" title="\u6807\u8bb0\u6709\u96f7:\u7ea2\u8272\u6253\u5f00,\u767d\u8272\u5173\u95ed">\u6807\u8bb0</p>');c.html(f,this.config.mines),c.html(e,"\u7b2c"+(this.status<1?1:this.status)+"\u5173"),c.html(h,this.config.time),this.config.numEl=f,this.config.floor=e,this.config.btn=g,this.config.flagEl=i,this.config.timeEl=h,c.append(f,d),c.append(e,d),c.append(g,d),c.append(h,d),c.append(i,d),c.prepend(d,"#content"),b(g).on("click",function(){a.start()})},createTable:function(a){var b=c.create('<table id="table"></table>'),d="",e,f,g,h;for(e=0;e<a;e++){d+='<tr id="row'+e+'">';for(f=0;f<a;f++)d+='<td id="t'+e+"-"+f+'" class="hidden"></td>';d+="</tr>"}c.html(b,d),c.append(b,"#content")},bindEvent:function(){var a=this;b("#content td").on("click",function(c){if(a.status===-1||!a.status)return;var d=c.target,e=d.id,f=e.indexOf("-"),g=e.substring(1,f),h=e.substring(f+1),i=a.mineArr[g][h],j=b(a.config.flagEl).hasClass("flaging");if(b(d).hasClass("hidden"))if(!j){if(b(d).hasClass("flag"))return!1;i==-1?a.end("bomb"):a.open(g,h)}else b(d).hasClass("flag")?(b(d).removeClass("flag"),b(a.config.numEl).html(++a.last)):(b(d).addClass("flag"),b(a.config.numEl).html(--a.last))}),b(a.config.flagEl).on("click",function(a){var c=a.target;b(c).hasClass("flaging")?b(c).removeClass("flaging"):b(c).addClass("flaging")})},start:function(){var d=this.config.btn;if(b(d).hasClass("disabled"))return;b(d).addClass("disabled");var e=this.config;c.html(e.timeEl,e.time),this.time=e.time,this.status<1&&(this.status=1),this.timer=a.later(function(){this.time?c.html(e.timeEl,--this.time):this.end("time")},1e3,!0,this)},end:function(a){this.timer.cancel(),b(this.config.btn).removeClass("disabled"),arguments[0]=="time"?(this.status=0,this.openBomb(),alert("\u65f6\u95f4\u5230\uff010\u5206\uff01")):a=="bomb"?(this.openBomb(),this.status=0,alert("\u8e29\u5230\u96f7\u5566\uff010\u5206\uff01")):a=="pass"&&(alert("\u606d\u559c\u8fc7\u5173!"),this.init(++this.status))},open:function(a,d){var e=c.get("#t"+a+"-"+d),f=this.mineArr[a][d],g=this.config.size-1;a=parseInt(a),d=parseInt(d),e.className=="hidden"&&(f==0?(b(e).addClass("open"),this.unopen--,a>0&&d>0&&this.open(a-1,d-1),a>0&&this.open(a-1,d),a>0&&d<g&&this.open(a-1,d+1),d>0&&this.open(a,d-1),d<g&&this.open(a,d+1),a<g&&d>0&&this.open(a+1,d-1),a<g&&this.open(a+1,d),a<g&&d<g&&this.open(a+1,d+1)):f>0&&(b(e).addClass("num").html(f),this.unopen--)),this.unopen==this.config.mines&&this.end("pass")},openBomb:function(){var a=this.mineArr,c=this.config.size;for(var d=0;d<c;d++)for(var e=0;e<c;e++)a[d][e]===-1&&b("#t"+d+"-"+e).addClass("bomb").html("\u96f7")}}),e}),KISSY.add("page/init",function(a,b){new b},{requires:["./mods/bomb"]}); 